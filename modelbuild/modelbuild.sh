#Registration levels generated by
#ants_generate_iterations.py --min 1 --max 296 --output modelbuild

antsMultivariateTemplateConstruction2.sh -d 3 -r 0 -n 0 -z ../model-staging/initial_recrop.nii.gz \
-o rigid_ \
-q 500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x225x75x0 \
-f 9x9x9x9x9x9x9x9x9x9x9x9x9x8x7x6x5x4x3x2x1 \
-s 8.90776219086x8.48259483674x8.05737406603x7.63209095045x7.20673445272x6.78129076418x6.35574237559x5.93006674681x5.50423435717x5.07820577132x4.65192708599x4.22532260674x3.79828256043x3.37064139994x2.94213702015x2.51232776601x2.08040503813x1.64470459404x1.20112240879x0.735534255037x0.0mm \
-m MI -t Rigid \
../*/*n4.nii.gz

cp rigid_template0.nii.gz ../model-staging

antsMultivariateTemplateConstruction2.sh -d 3 -r 0 -n 0 -z ../model-staging/rigid_template0.nii.gz \
-o affine_ \
-q 500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x225x75x0 \
-f 9x9x9x9x9x9x9x9x9x9x9x9x9x8x7x6x5x4x3x2x1 \
-s 8.90776219086x8.48259483674x8.05737406603x7.63209095045x7.20673445272x6.78129076418x6.35574237559x5.93006674681x5.50423435717x5.07820577132x4.65192708599x4.22532260674x3.79828256043x3.37064139994x2.94213702015x2.51232776601x2.08040503813x1.64470459404x1.20112240879x0.735534255037x0.0mm \
-m MI -t Affine \
../*/*n4.nii.gz

cp affine_template0.nii.gz ../model-staging

antsMultivariateTemplateConstruction2.sh -d 3 -r 0 -n 0 -z ../model-staging/affine_template0.nii.gz \
-o nlin_ \
-q 500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x225x75x25 \
-f 9x9x9x9x9x9x9x9x9x9x9x9x9x8x7x6x5x4x3x2x1 \
-s 8.90776219086x8.48259483674x8.05737406603x7.63209095045x7.20673445272x6.78129076418x6.35574237559x5.93006674681x5.50423435717x5.07820577132x4.65192708599x4.22532260674x3.79828256043x3.37064139994x2.94213702015x2.51232776601x2.08040503813x1.64470459404x1.20112240879x0.735534255037x0.0mm \
../*/*n4.nii.gz

cp nlin_template0.nii.gz ../model-staging

#Now that we have a much better ROI and model, upsample and recrop and run one more round of modelbuilding

ImageMath 3 ../model-staging/nlin_template0_upsample.nii.gz PadImage ../model-staging/nlin_template0.nii.gz 50
ResampleImage 3 ../model-staging/nlin_template0_upsample.nii.gz ../model-staging/nlin_template0_upsample.nii.gz 0.5x0.5x0.5
ThresholdImage 3 ../model-staging/nlin_template0_upsample.nii.gz ../model-staging/nlin_template0_upsample_otsu.nii.gz Otsu 1
ExtractRegionFromImageByMask 3 ../model-staging/nlin_template0_upsample.nii.gz \
  ../model-staging/nlin_template0_upsample_recrop.nii.gz \
  ../model-staging/nlin_template0_upsample_otsu.nii.gz 1 20

#Registration levels generated by
#ants_generate_iterations.py --min 0.5 --max 263 --output modelbuild

antsMultivariateTemplateConstruction2.sh -d 3 -r 0 -n 0 -z ../model-staging/nlin_template0_upsample_recrop.nii.gz \
-o nlin2_ \
-q 500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x500x225x75x25 \
-f 16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x16x15x14x13x12x11x10x9x8x7x6x5x4x3x2x1 \
-s 8.06576279716x7.85335679808x7.64094659947x7.42853184108x7.21611212025x7.00368698545x6.79125592865x6.57881837617x6.36637367777x6.15392109336x5.941459777x5.72898875721x5.51650691278x5.30401294279x5.09150532907x4.87898228882x4.66644171435x4.45388109543x4.24129741837x4.02868703302x3.81604547522x3.60336722636x3.39064538209x3.1778711878x2.96503337341x2.75211717859x2.53910288566x2.32596354299x2.11266130337x1.89914128022x1.68532069997x1.47106851007x1.25616388301x1.04020251906x0.822352297022x0.600561204393x0.367767127519x0.0mm \
../*/*n4.nii.gz
